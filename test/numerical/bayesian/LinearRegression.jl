mtcars = dataset("datasets", "mtcars")

tests = Any[(Prior_Ridge(), Any[[:v, :σ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [6.607340667183019, 2.699477538245194, 28.394257532027698, -0.039738300575837285, -2.64378747269333, 1.6316385131879014], [3.491059498435052, 0.40768138268871024, 5.365068902763022, 0.009928437804916002, 0.9268396369542333, 0.9821403947803388], [0.11039699462219793, 0.012892017289430641, 0.16965837536471584, 0.00031396477070857055, 0.02930924278498943, 0.03105800629562818], [0.19354267507663853, 0.02085318073331585, 0.4385251011532493, 0.0006471335084166524, 0.07309020857074884, 0.07790312528652366], [368.89025806232695, 315.29708652931345, 128.54634566456218, 266.6067323994925, 149.2843322823497, 137.81454895126734], [1.0013398640961664, 1.0025189660644673, 1.0036731599981588, 1.0010641470993362, 0.9998000296875771, 1.0018877542806597]], Any[[:v, :σ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [2.4212458634226697, 2.026823862703129, 15.720610006377486, -0.05984492385059591, -4.419730033046315, -0.0825500808646622], [4.4250834097559, 2.438488286693904, 25.024506737082817, -0.046258860075479705, -3.224780457008902, 0.9386373404904507], [5.903138855066658, 2.643749066315433, 28.938984206385413, -0.04015784097403732, -2.714303226586158, 1.5681965630215153], [7.9495324423533535, 2.911378034255043, 32.01010293573062, -0.03291013380284851, -2.064272126221539, 2.2177045092797476], [14.655641098614485, 3.6313006078186847, 37.85299526057768, -0.01830280092513684, -0.5918561698621544, 3.882437389236233]], [23.64682710933115, 22.978085538393668, 25.114650776762073, 20.433970265888107, 17.239817287059495, 19.9917682305048, 14.094488948945079, 24.07501101832066, 22.857836775895713, 20.975546641108245, 20.975546641108245, 15.387317853539544, 16.278973281456235, 16.147847483233182, 11.29117713592764, 10.434230606292255, 10.04046623975584, 26.51105032240928, 28.60610241416577, 27.508331524619415, 22.921674616598743, 18.031587889450673, 18.254501746429835, 13.386409638540638, 16.177698321452844, 27.206017052991427, 27.31928924531768, 28.082223501032413, 17.68722039545056, 22.301822672425917, 13.793749871749785, 23.267287430199303]), (Prior_Laplace(), Any[[:v, :σ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [4.235723514259716, 2.6639612078951864, 29.301408017856637, -0.039307512833917604, -2.7698905098663205, 1.4781190925131318], [3.20891251839575, 0.38142349330289577, 5.002849404169662, 0.010629597141097694, 0.9211725785793806, 0.9122585073113623], [0.10147472370357534, 0.012061669919351307, 0.15820398907992408, 0.0003361373757588291, 0.02913003466401276, 0.02884814697969273], [0.17659652045754295, 0.02032243226520116, 0.2685620398283256, 0.0005001071263886794, 0.04997091724559722, 0.04742728649269598], [403.6650854968192, 408.9618465724659, 294.611355581558, 415.9218666196696, 307.2041837064655, 307.40993998520383], [1.0000554135678112, 1.0011096863970959, 1.0007068594761066, 0.9990133983023143, 0.9996468036010154, 1.0003684140047449]], Any[[:v, :σ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [1.2645661289409462, 2.0322753765213943, 18.671257214522225, -0.059211647766535896, -4.4885115851557815, -0.2740292866593391], [2.397496468992026, 2.3897422548178917, 26.20175694528251, -0.04654685895388636, -3.41918592757722, 0.8666119463738915], [3.376719361510677, 2.624386888978689, 29.58466877774019, -0.0395678031370976, -2.8075165491136946, 1.4380167984029608], [5.205021588983238, 2.9037729534870063, 32.72730266469587, -0.03183260317088086, -2.201069745767492, 2.0569756173503317], [11.552432531554901, 3.5061139511018524, 38.3280311105727, -0.018157002215173704, -0.7809609062273537, 3.4048011931840114]], [23.62991629141266, 22.924911198568523, 25.12882269366041, 20.503096531237777, 17.3212236853496, 20.022647122219077, 14.205091370336493, 23.94434343717917, 22.75533686448621, 20.850879185159755, 20.850879185159755, 15.382537971863979, 16.32254476232279, 16.184308469608265, 11.135619337388441, 10.260740188176813, 9.888428254818207, 26.523895292700917, 28.692603508252002, 27.572401914573476, 23.088602827690313, 18.08458774341895, 18.319589441033624, 13.458615389678027, 16.201509714361887, 27.25654764408793, 27.187044594417685, 28.054130633814804, 17.526345449723078, 22.13720576146823, 13.624355468994995, 23.22694183978261]), (Prior_Cauchy(), Any[[:σ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [2.600355909747377, 30.548270946626495, -0.039016816965275446, -2.8902387376044243, 1.2357778841250202], [0.3340917189990897, 4.672237217177979, 0.010073346810676174, 0.8736273783371867, 0.8488104650057622], [0.01056490779438073, 0.147749113748892, 0.00031854719582529654, 0.027626523418271542, 0.026841743712048557], [0.013776069654030476, 0.37169820166720147, 0.0006449676668444711, 0.07005969567747433, 0.06163209105292748], [469.9250665390617, 165.5309433906942, 267.1002338617348, 166.8454608267688, 191.33777695493512], [1.0012308035611848, 0.9990690960354791, 0.9992956705473691, 0.9990143396849651, 0.9992008418730554]], Any[[:σ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [2.024681373457793, 20.831896047312192, -0.056820885688377905, -4.541446435152564, -0.29034120525794027], [2.3594968282195636, 27.326286165514414, -0.04605071537231306, -3.4974413684025234, 0.6416696386923696], [2.5758161425281267, 30.770181256734375, -0.03924734214023336, -2.9260808143297874, 1.1863942005964803], [2.823106942093609, 33.892861917025805, -0.0325251140259356, -2.327245563100543, 1.8192454925307198], [3.3048356481576584, 39.03853127760354, -0.018363322703892068, -1.1865252002998017, 3.0221966213839804]], [23.62976692630291, 22.89685821621557, 25.15321650073299, 20.649426325976346, 17.474609102087214, 20.13973090838782, 14.378364525146964, 23.858429432651278, 22.689881793411338, 20.76733583322043, 20.76733583322043, 15.469421690944703, 16.446633304394474, 16.30292571418127, 11.105563689632392, 10.216517726778186, 9.860160395946632, 26.548262299307797, 28.77416207327947, 27.636222062755465, 23.310666792760376, 18.217035830026767, 18.46133873338923, 13.602343537995653, 16.310577621360263, 27.309912527437792, 27.018572812072403, 27.964990185738976, 17.329473057498095, 21.940731364522936, 13.418313138515321, 23.20879699251189]), (Prior_TDist(), Any[[:ν, :σ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [1.040270812419262, 2.6235336125736075, 30.175865641299893, -0.03969385898530461, -2.7827214820937343, 1.268036031355139], [0.5411708292011314, 0.36700477700639694, 4.485941658194438, 0.010527330465684496, 0.8788931011306884, 0.8028299363425789], [0.01711332423517535, 0.011605710075024067, 0.14185793090526969, 0.00033290341952844064, 0.02779304019381684, 0.025387711726105395], [0.02534218738477959, 0.01520534944766011, 0.2534177370344823, 0.0005047399567125213, 0.047577028417198, 0.04462487451913028], [602.398595852702, 476.36511481183464, 271.85395032251796, 462.9108468681422, 300.29224595797666, 298.52729501043575], [0.9990149496249879, 0.9994472834718284, 1.0054715198340691, 1.0039684403499889, 1.0061027527022233, 1.004592991260601]], Any[[:ν, :σ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [0.3548556031258318, 2.05170328103284, 20.759628451914395, -0.05957721934126292, -4.456015388837275, -0.22996586956801818], [0.6699924161346282, 2.367878544476649, 27.41857797808396, -0.04682854405425855, -3.3526136619116254, 0.7136739267115854], [0.9279692698997398, 2.565255304585415, 30.386971229617615, -0.039648448839578396, -2.826298619939151, 1.2307951378868438], [1.2860575636707143, 2.8284711313966335, 33.27419168929428, -0.03233244126546936, -2.245979502282706, 1.7334705481655053], [2.3207915402042256, 3.5158855091342165, 37.74269546696291, -0.020591257021996934, -1.0229467731040367, 3.0287062633878112]], [23.593876974643088, 22.876145780137215, 25.107985514028975, 20.668690609163946, 17.474708471576772, 20.176081882714364, 14.351140240141577, 23.880507665862453, 22.693050383034453, 20.773740642254854, 20.773740642254854, 15.50451407962381, 16.461489005631645, 16.320757398865783, 11.198367426433816, 10.314669141482339, 9.946096640062976, 26.50941256246397, 28.70750557239333, 27.576148521195368, 23.29180269208001, 18.23441863426708, 18.473662365769048, 13.591189563605937, 16.334782456773297, 27.255290078323043, 26.943890002032763, 27.84196930538285, 17.229444226727473, 21.861472492170222, 13.306530089416032, 23.18293106233302]), (Prior_HorseShoe(), Any[[:τ, Symbol("λ[1]"), Symbol("λ[2]"), Symbol("λ[3]"), Symbol("λ[4]"), :σ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [1.52607315433313, 24.205882664738812, 0.344433788637113, 2.1643091175053097, 1.1324127947378992, 2.6140528930591684, 31.825196444419166, -0.03718750165924088, -3.0585437882292315, 0.9625297419261658], [1.653436628885164, 136.84662174860466, 0.5997005115099233, 4.549854958746539, 2.6244962585859613, 0.35173053158260453, 4.8143437819468, 0.010962145990862452, 0.9422651791063842, 0.8549879939853496], [0.05228625714027669, 4.327470148251248, 0.018964195303393806, 0.14387904693050502, 0.0829938588772188, 0.01112269602422819, 0.15224291790020913, 0.000346653493744087, 0.029797041258426755, 0.027037094330920476], [0.08278836050174082, 6.334386700900134, 0.020015964591545473, 0.21823240304279537, 0.12212634748944012, 0.0164685382484837, 0.3049900394294881, 0.000555243288455267, 0.05947152557139189, 0.052262805446505724], [436.8229930227651, 451.4820260345402, 781.1539237432106, 389.8004086335117, 493.6815490484523, 460.62831751040153, 179.83766683208404, 294.1383108546387, 178.2694712808865, 198.7195339053038], [0.9997101926305484, 0.9998782544528467, 0.9993014504451135, 1.0001901554458053, 1.000369973711868, 0.9993143619663889, 1.0103301911665639, 1.0042245045380216, 1.0099104881988727, 1.0077410709523096]], Any[[:τ, Symbol("λ[1]"), Symbol("λ[2]"), Symbol("λ[3]"), Symbol("λ[4]"), :σ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [0.2477042645801483, 1.6287675688213055, 0.005922740663151995, 0.21826548671599152, 0.04367624282828437, 2.0417245294556476, 20.92161579135289, -0.059722585054399084, -4.774052298938284, -0.3639668559814557], [0.6709094943237014, 5.351068220543937, 0.041778499463554566, 0.7248208218398899, 0.29316480976656534, 2.373099898238334, 29.15431560825959, -0.04419876436949889, -3.6626332777131108, 0.3356855034316811], [1.0774250598523105, 9.85377853001237, 0.1257474048093926, 1.2996762871206435, 0.6093858024412372, 2.5859178295706, 32.3071856622101, -0.03687215083724006, -3.1250172596388257, 0.8593885012492797], [1.8007559712065662, 20.716613155337875, 0.3737146608282301, 2.4004471925258204, 1.1282492513442852, 2.8043258706747736, 35.17246863144161, -0.030046928633665145, -2.5222082075298955, 1.472765945487665], [5.621232409934779, 83.54871228477566, 2.223143884055017, 8.016843761817922, 4.863432715313981, 3.3936490070925167, 39.460306836994654, -0.017108794888194282, -1.0155483665850953, 2.8540975845378287]], [23.570088498140663, 22.79451075623804, 25.11490471774875, 20.776812560192294, 17.674587015629424, 20.217641342688662, 14.67531048745098, 23.621964559402088, 22.516078520492776, 20.592495350112245, 20.592495350112245, 15.572462059937727, 16.606565715807896, 16.454491648768197, 11.053555522844666, 10.152354347564243, 9.834656240513773, 26.48423771799592, 28.784281093135796, 27.6315767495842, 23.541502014365047, 18.361227063321262, 18.619752977288787, 13.854110525436452, 16.442787072607587, 27.290230273306513, 26.7203625836638, 27.809007855981307, 17.152323602353917, 21.679568594313032, 13.294648769962707, 23.120649825811753])]

for (prior, test_summaries, test_quantiles, prediction) in tests
    CRRao.set_rng(StableRNG(123))
    model = fit(@formula(MPG ~ HP + WT + Gear), mtcars, LinearRegression(), prior)

    #Split summaries and quantiles into symbols and numbers for testing equality/approximate equality. 
    model_summaries, model_quantiles = describe(model.chain)
    (model_summaries_symbols, model_summaries_nums...) = model_summaries.nt
    (model_quantiles_symbols, model_quantiles_nums...) = model_quantiles.nt
    (test_summaries_symbols, test_summaries_nums...) = test_summaries
    (test_quantiles_symbols, test_quantiles_nums...) = test_quantiles

    @test model_summaries_symbols == test_summaries_symbols
    for i in eachindex(test_summaries_nums)
        @test model_summaries_nums[i] ≈ test_summaries_nums[i]
    end
    @test model_quantiles_symbols == test_quantiles_symbols
    for i in eachindex(test_quantiles_nums)
        @test model_quantiles_nums[i] ≈ test_quantiles_nums[i]
    end
    @test predict(model, mtcars) ≈ prediction
end

gauss_tests = (Any[[:σ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [2.4764436914924737, 30.55213366988879, -0.03797480301227029, -2.9881439649327963, 1.2777860687095592], [0.3154037058595231, 2.224548598697289, 0.00884272074456698, 0.5599631827225042, 0.47523077241931394], [0.009973940929738884, 0.07034640337619309, 0.0002796313826565166, 0.017707590632401595, 0.015028116550461596], [0.013359156295927994, 0.1041296143458426, 0.000394830465226354, 0.025995705664700178, 0.02209530300124711], [704.4834067564985, 370.19716824547663, 423.6585544571588, 360.5083273968527, 420.7095584129223], [0.9990016164057623, 1.0001462331991913, 0.9990089470963095, 0.9991687291385768, 1.0021401722295347]], Any[[:σ, Symbol("β[1]"), Symbol("β[2]"), Symbol("β[3]"), Symbol("β[4]")], [1.9410604068671178, 26.204138838171385, -0.05697730772851603, -4.112948126979683, 0.34008724619538633], [2.259583355892342, 29.178435279511742, -0.043340404993751795, -3.356818867625608, 0.9732485199505923], [2.448784680744309, 30.482232783788163, -0.03751488390109284, -3.0087538817361477, 1.2793687060592247], [2.6725695602240505, 31.951621030761657, -0.032116329709597685, -2.63514094828801, 1.579853172736121], [3.1647848942553343, 35.019481195628394, -0.021599639882778736, -1.820616619681824, 2.247668189263121]], [23.65224810558515, 22.887502619039783, 25.194047663066446, 20.595321513349308, 17.465461729346263, 20.04941868855323, 14.431654483936152, 23.755802387636443, 22.62933502234124, 20.702049670068178, 20.702049670068178, 15.387237884623858, 16.406898533351065, 16.256948437950005, 10.90415241981341, 10.004620802479524, 9.674984025205903, 26.573732162442095, 28.85693567810798, 27.706138387403655, 23.335589815304818, 18.169804790050073, 18.42471995223188, 13.621923968770446, 16.250865956597718, 27.368467668067755, 27.081929520541124, 28.13135208912636, 17.45865611892859, 22.019833921646992, 13.577347829818908, 23.21017832883562])

(test_summaries, test_quantiles, prediction) = gauss_tests

CRRao.set_rng(StableRNG(123))
model = fit(@formula(MPG ~ HP + WT + Gear), mtcars, LinearRegression(), Prior_Gauss(), 30.0, [0.0,-3.0,1.0], 1000)

#Split summaries and quantiles into symbols and numbers for testing equality/approximate equality.
model_summaries, model_quantiles = describe(model.chain)
(model_summaries_symbols, model_summaries_nums...) = model_summaries.nt
(model_quantiles_symbols, model_quantiles_nums...) = model_quantiles.nt
(test_summaries_symbols, test_summaries_nums...) = test_summaries
(test_quantiles_symbols, test_quantiles_nums...) = test_quantiles

@test model_summaries_symbols == test_summaries_symbols
for i in eachindex(test_summaries_nums)
    @test model_summaries_nums[i] ≈ test_summaries_nums[i]
end
@test model_quantiles_symbols == test_quantiles_symbols
for i in eachindex(test_quantiles_nums)
    @test model_quantiles_nums[i] ≈ test_quantiles_nums[i]
end
@test predict(model, mtcars) ≈ prediction